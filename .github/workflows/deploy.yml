name: Auto Deploy on Source B

on:
  push:
    branches:
      - main  # K√≠ch ho·∫°t khi c√≥ code push v√†o main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: C√†i ƒë·∫∑t sshpass
        run: sudo apt-get install -y sshpass

      #- name: Debug Network
       # run: |
        #  echo "üîç Ki·ªÉm tra k·∫øt n·ªëi ƒë·∫øn SSH server..."
         # nc -zv ${{ secrets.SOURCE_B_HOST }} ${{ secrets.SOURCE_B_PORT }} || echo "‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server"

      - name: K·∫øt n·ªëi SSH b·∫±ng m·∫≠t kh·∫©u v√† tri·ªÉn khai code
        run: |
          sshpass -p "${{ secrets.SSH_PASSWORD }}" ssh -o StrictHostKeyChecking=no \
          -p ${{ secrets.SOURCE_B_PORT }} \
          ${{ secrets.SOURCE_B_USER }}@${{ secrets.SOURCE_B_HOST }} << 'EOF'
          
          echo "‚úÖ ƒê√£ SSH v√†o server!"
          cd /mnt/c/Users/ADMIN/Desktop/Intern2025/Project/github-action-test/CRM-2025-ADMIN
          git pull origin main
          EOF
